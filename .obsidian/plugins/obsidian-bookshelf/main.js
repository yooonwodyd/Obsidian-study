"use strict";var v=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var y=(r,a)=>{for(var t in a)v(r,t,{get:a[t],enumerable:!0})},B=(r,a,t,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let l of m(a))!x.call(r,l)&&l!==t&&v(r,l,{get:()=>a[l],enumerable:!(i=b(a,l))||i.enumerable});return r};var L=r=>B(v({},"__esModule",{value:!0}),r);var F={};y(F,{default:()=>f});module.exports=L(F);var h=require("obsidian"),C={shelves:[],fileToShelf:{}},p="bookshelf-view",f=class extends h.Plugin{async onload(){if(await this.loadSettings(),!this.settings.shelves||this.settings.shelves.length===0){let t=new Set;this.app.vault.getMarkdownFiles().forEach(i=>{let l=i.path.split("/");l.length>1&&t.add(l[0])}),this.settings.shelves=Array.from(t),await this.saveSettings()}this.registerView(p,t=>new k(t,this)),this.addCommand({id:"open-bookshelf",name:"Open Bookshelf View",callback:()=>this.activateBookshelf()})}onunload(){this.app.workspace.detachLeavesOfType(p)}async loadSettings(){this.settings=Object.assign({},C,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}activateBookshelf(){let t=this.app.workspace.getRightLeaf(!1);t&&(t.setViewState({type:p,active:!0}),this.app.workspace.revealLeaf(t))}},u=class extends h.Modal{constructor(t,i){super(t);this.value="";this.onSubmit=i}onOpen(){this.titleEl.setText("\uC0C8 \uCC45\uC7A5 \uC774\uB984 \uC785\uB825"),new h.Setting(this.contentEl).setName("\uCC45\uC7A5 \uC774\uB984").addText(t=>t.setPlaceholder("\uC608: My Shelf").onChange(i=>this.value=i)),new h.Setting(this.contentEl).addButton(t=>t.setButtonText("\uC0DD\uC131").onClick(()=>{let i=this.value.trim();i&&this.onSubmit(i),this.close()}))}onClose(){this.contentEl.empty()}},k=class extends h.ItemView{constructor(t,i){super(t);this.plugin=i}getViewType(){return p}getDisplayText(){return"Bookshelf View"}async onOpen(){this.renderBookshelf()}async onClose(){this.containerEl.empty()}async renderBookshelf(){this.containerEl.empty();let t=this.containerEl.createDiv({cls:"bookshelf-header"});t.createEl("h2",{text:"Bookshelves"}),t.createEl("button",{text:"+"},e=>{e.addClass("add-shelf-btn"),e.onClickEvent(()=>{new u(this.app,async n=>{this.plugin.settings.shelves.includes(n)||(this.plugin.settings.shelves.push(n),await this.plugin.saveSettings(),this.renderBookshelf())}).open()})});let i=this.containerEl.createDiv({cls:"bookshelf"});for(let e of this.plugin.settings.shelves){let n=i.createDiv({cls:"shelf"}),g=n.createDiv({cls:"shelf-title"});g.createEl("h3",{text:e}),g.createEl("button",{text:"\u2715"}).onClickEvent(async()=>{this.plugin.settings.shelves=this.plugin.settings.shelves.filter(s=>s!==e);for(let s in this.plugin.settings.fileToShelf)this.plugin.settings.fileToShelf[s]===e&&delete this.plugin.settings.fileToShelf[s];await this.plugin.saveSettings(),this.renderBookshelf()});let c=n.createDiv({cls:"books"});c.addEventListener("dragover",s=>s.preventDefault()),c.addEventListener("drop",async s=>{s.preventDefault();let o=s.dataTransfer?.getData("text/plain");o&&(this.plugin.settings.fileToShelf[o]=e,await this.plugin.saveSettings(),this.renderBookshelf())});let S=this.app.vault.getMarkdownFiles();for(let s of S){let o=s.path.includes("/")?s.path.split("/")[0]:"";!this.plugin.settings.fileToShelf[s.path]&&o===e&&(this.plugin.settings.fileToShelf[s.path]=e)}let w=this.app.vault.getMarkdownFiles().filter(s=>this.plugin.settings.fileToShelf[s.path]===e);for(let s of w){let o=c.createDiv({cls:"book",attr:{draggable:"true"}}),T=s.path.replace(/.*\/(.*)\.md$/,"$1");o.createEl("span",{text:T}),o.addEventListener("dragstart",D=>{D.dataTransfer?.setData("text/plain",s.path),o.addClass("dragging")}),o.addEventListener("dragend",()=>o.removeClass("dragging")),o.onClickEvent(()=>this.app.workspace.openLinkText(s.path,s.path,!1))}}let l=i.createDiv({cls:"shelf"});l.createEl("h3",{text:"Unassigned"});let d=l.createDiv({cls:"books"});d.addEventListener("dragover",e=>e.preventDefault()),d.addEventListener("drop",async e=>{e.preventDefault();let n=e.dataTransfer?.getData("text/plain");n&&(delete this.plugin.settings.fileToShelf[n],await this.plugin.saveSettings(),this.renderBookshelf())});let E=this.app.vault.getMarkdownFiles().filter(e=>!this.plugin.settings.fileToShelf[e.path]);for(let e of E){let n=d.createDiv({cls:"book",attr:{draggable:"true"}}),g=e.path.replace(/.*\/(.*)\.md$/,"$1");n.createEl("span",{text:g}),n.addEventListener("dragstart",c=>{c.dataTransfer?.setData("text/plain",e.path),n.addClass("dragging")}),n.addEventListener("dragend",()=>n.removeClass("dragging")),n.onClickEvent(()=>this.app.workspace.openLinkText(e.path,e.path,!1))}await this.plugin.saveSettings()}};
