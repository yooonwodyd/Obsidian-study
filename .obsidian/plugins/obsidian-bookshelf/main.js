"use strict";var f=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var T=(r,a)=>{for(var e in a)f(r,e,{get:a[e],enumerable:!0})},b=(r,a,e,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let h of w(a))!D.call(r,h)&&h!==e&&f(r,h,{get:()=>a[h],enumerable:!(c=E(a,h))||c.enumerable});return r};var L=r=>b(f({},"__esModule",{value:!0}),r);var x={};T(x,{default:()=>g});module.exports=L(x);var d=require("obsidian"),S={shelves:["Unassigned"],fileToShelf:{}},p="bookshelf-view",g=class extends d.Plugin{async onload(){this.settings=Object.assign({},S,await this.loadData()),this.registerView(p,e=>new v(e,this)),this.addCommand({id:"open-bookshelf",name:"Open Bookshelf View",callback:()=>this.activateBookshelf()})}onunload(){this.app.workspace.detachLeavesOfType(p)}async saveSettings(){await this.saveData(this.settings)}activateBookshelf(){let e=this.app.workspace.getRightLeaf(!1);if(!e){console.warn("Bookshelf View: No available leaf to open view.");return}e.setViewState({type:p,active:!0}),this.app.workspace.revealLeaf(e)}},v=class extends d.ItemView{constructor(e,c){super(e);this.plugin=c}getViewType(){return p}getDisplayText(){return"Bookshelf View"}async onOpen(){this.renderBookshelf()}async onClose(){this.containerEl.empty()}async renderBookshelf(){this.containerEl.empty();let e=this.containerEl.createDiv({cls:"bookshelf-header"});e.createEl("h2",{text:"Bookshelves"}),e.createEl("button",{text:"+"},n=>{n.addClass("add-shelf-btn"),n.onClickEvent(async()=>{console.log("\u2795 \uD50C\uB7EC\uC2A4 \uD074\uB9AD \uAC10\uC9C0!");let l=window.prompt("\uC0C8 \uCC45\uC7A5 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");l&&!this.plugin.settings.shelves.includes(l)&&(this.plugin.settings.shelves.push(l),await this.plugin.saveSettings(),this.renderBookshelf())})});let c=this.containerEl.createDiv({cls:"bookshelf"});for(let n of this.plugin.settings.shelves){let l=c.createDiv({cls:"shelf"});l.createEl("h3",{text:n});let t=l.createDiv({cls:"books"});t.addEventListener("dragover",s=>s.preventDefault()),t.addEventListener("drop",async s=>{s.preventDefault();let o=s.dataTransfer?.getData("text/plain");o&&(this.plugin.settings.fileToShelf[o]=n,await this.plugin.saveSettings(),this.renderBookshelf())});let i=this.app.vault.getMarkdownFiles().filter(s=>this.plugin.settings.fileToShelf[s.path]===n);for(let s of i){let o=t.createDiv({cls:"book",attr:{draggable:"true"}}),k=s.path.replace(/.*\/(.*)\.md$/,"$1");o.createEl("span",{text:k}),o.addEventListener("dragstart",u=>{u.dataTransfer?.setData("text/plain",s.path),o.addClass("dragging")}),o.addEventListener("dragend",()=>{o.removeClass("dragging")}),o.onClickEvent(()=>this.app.workspace.openLinkText(s.path,s.path,!1))}}let h=this.app.vault.getMarkdownFiles().filter(n=>!this.plugin.settings.fileToShelf[n.path]);if(h.length){let n=c.createDiv({cls:"shelf"});n.createEl("h3",{text:"Unassigned"});let l=n.createDiv({cls:"books"});l.addEventListener("dragover",t=>t.preventDefault()),l.addEventListener("drop",async t=>{t.preventDefault();let i=t.dataTransfer?.getData("text/plain");i&&(delete this.plugin.settings.fileToShelf[i],await this.plugin.saveSettings(),this.renderBookshelf())});for(let t of h){let i=l.createDiv({cls:"book",attr:{draggable:"true"}}),s=t.path.replace(/.*\/(.*)\.md$/,"$1");i.createEl("span",{text:s}),i.addEventListener("dragstart",o=>{o.dataTransfer?.setData("text/plain",t.path),i.addClass("dragging")}),i.addEventListener("dragend",()=>{i.removeClass("dragging")}),i.onClickEvent(()=>this.app.workspace.openLinkText(t.path,t.path,!1))}}}};
