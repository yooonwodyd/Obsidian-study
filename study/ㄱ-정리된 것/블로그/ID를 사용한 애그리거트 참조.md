ee아키텍쳐의 영역을 4가지로 나누면 다음과 같다.

1. 표현: 표현 영역은 사용자의 요청을 해석해서 응용서비스에 전달하고, 응용 서비스의 실행 결과를 사용자가 이해할 수 있는 형식으로 변환하여 응답한다.
2. 응용: 응용 영역은 도메인 모델을 이용해서 사용자에게 제공할 기능을 구현한다.
실제 도메인 로직 구현은 도메인 모델에 위임한다.
3. 도메인: 도메인 모델을 구현하는 영역. 도메인의 핵심 로직이 담겨있다.
4. 인프라스트럭쳐: 인프라스트럭처 영역은  세부적인 구현 기술을 다룬다.


### 도메인 영역을 구성하는 요소들
엔티티 - 고유의 식별자를 갖는 객체로, 자신의 라이프 사이클을 가진다. 주문, 회원, 상품과 같이 도메인의 고유한 개념을 표현한다.

밸류 고유의 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 값을 표현할 때 사용한다.

애그리거트 - 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다. 
예를 들어 주문과 관련된 Order 엔티티, OrderLine 벨류, Orderer 밸류 객체를 주문 애그리거트로 묶을 수 있다.

레포지토리 - 도메인 모델의 영속성을 처리한다. 예를 들어 DBMS 테이블에서 엔티티 객체를 로딩하거나 저장하는 기능을 제공한다.

도메인 서비스 - 특정 엔티티에 속하지 않는 도메인 로직을 제공한다. 도메인 로직이 여러 엔티티와 밸류를 필요로 하면 도메인 서비스에서 로직을 구현한다.


### 애그리거트에서 주의점

어떤 기술을 사용하느냐에 따라 애그리거트의 구현도 영향을 받는다.
애그리거트는 개념상 완전한 한 개의 도메인 모델을 표현함으로 객체의 영속성을 처리하는 리포지터리는 애그리거트 단위로 존재해야하지만, JPA와 같은 기술을 사용한다면 데이터베이스 관계형 모델에 따라 객체 도메인 모델을 맞춰야 할 때도 있다.

**일반적으로 한 트랜잭션에서 한 개의 애그리거트를 변경하는 것이 권장된다.** 


JPA를 사용하다 보면 필드를 통해 다른 애그리거트를 참조하는 경우가 많다. (예를 들자면 Order 애그리거트에서 User 애그리거트를 참조하는 경우) 이때 우리가 고려해야하는 것은 무엇이 있는가?

1. 객체를 지연 로딩 시킬 것인가. 즉시 로딩 시킬것인가? 무엇이 더 적절한가?
2. 확장이 필요한 영역일 가능성이 있는가?

2번의 예시를 들자면, Order와 User 애그리거트가 사용자수의 증가와 별도의 이유로 다른 DBMS를 사용해야한다면 어떻게 할 것인가? 
이런 경우에는 UserID를 필드로 가짐으로서 객체가 참조로 연결되지 않게 할 수 있을 것이다.

다만 이 경우 N+1 문제가 발생할 수 있다. 객체의 참조를 통해 연결된다면 즉시로딩을 통해 불러올 수 있지만 ID를 통해 가져온다면 불가능하다. 이 경우에는 데이터 조회를 위한 별도 DAO를 만들어 해결할 수 있다.


